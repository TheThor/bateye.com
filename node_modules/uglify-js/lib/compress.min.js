"use strict";function Compressor(c,g){if(!(this instanceof Compressor)){return new Compressor(c,g)}TreeTransformer.call(this,this.before,this.after);this.options=defaults(c,{booleans:!g,cascade:!g,collapse_vars:!g,comparisons:!g,conditionals:!g,dead_code:!g,drop_console:false,drop_debugger:!g,evaluate:!g,expression:false,global_defs:{},hoist_funs:!g,hoist_vars:false,ie8:false,if_return:!g,inline:!g,join_vars:!g,keep_fargs:true,keep_fnames:false,keep_infinity:false,loops:!g,negate_iife:!g,passes:1,properties:!g,pure_getters:!g&&"strict",pure_funcs:null,reduce_vars:!g,sequences:!g,side_effects:!g,switches:!g,top_retain:null,toplevel:!!(c&&c.top_retain),typeofs:!g,unsafe:false,unsafe_comps:false,unsafe_Func:false,unsafe_math:false,unsafe_proto:false,unsafe_regexp:false,unused:!g,warnings:false},true);var a=this.options.global_defs;if(typeof a=="object"){for(var d in a){if(/^@/.test(d)&&HOP(a,d)){a[d.slice(1)]=parse(a[d],{expression:true})}}}var f=this.options.pure_funcs;if(typeof f=="function"){this.pure_funcs=f}else{this.pure_funcs=f?function(i){return f.indexOf(i.expression.print_to_string())<0}:return_true}var b=this.options.top_retain;if(b instanceof RegExp){this.top_retain=function(i){return b.test(i.name)}}else{if(typeof b=="function"){this.top_retain=b}else{if(b){if(typeof b=="string"){b=b.split(/,/)}this.top_retain=function(i){return b.indexOf(i.name)>=0}}}}var e=this.options.toplevel;this.toplevel=typeof e=="string"?{funcs:/funcs/.test(e),vars:/vars/.test(e)}:{funcs:e,vars:e};var h=this.options.sequences;this.sequences_limit=h==1?800:h|0;this.warnings_produced={}}Compressor.prototype=new TreeTransformer;merge(Compressor.prototype,{option:function(a){return this.options[a]},exposed:function(c){if(c.global){for(var b=0,a=c.orig.length;b<a;b++){if(!this.toplevel[c.orig[b] instanceof AST_SymbolDefun?"funcs":"vars"]){return true}}}return false},compress:function(c){if(this.option("expression")){c.process_expression(true)}var b=+this.options.passes||1;for(var a=0;a<b&&a<3;++a){if(a>0||this.option("reduce_vars")){c.reset_opt_flags(this,true)}c=c.transform(this)}if(this.option("expression")){c.process_expression(false)}return c},info:function(){if(this.options.warnings=="verbose"){AST_Node.warn.apply(AST_Node,arguments)}},warn:function(c,a){if(this.options.warnings){var b=string_template(c,a);if(!(b in this.warnings_produced)){this.warnings_produced[b]=true;AST_Node.warn.apply(AST_Node,arguments)}}},clear_warnings:function(){this.warnings_produced={}},before:function(d,b,c){if(d._squeezed){return d}var e=false;if(d instanceof AST_Scope){d=d.hoist_declarations(this);e=true}b(d,this);b(d,this);var a=d.optimize(this);if(e&&a instanceof AST_Scope){a.drop_unused(this);b(a,this)}if(a===d){a._squeezed=true}return a}});(function(){function j(C,B){C.DEFMETHOD("optimize",function(F){var D=this;if(D._optimized){return D}if(F.has_directive("use asm")){return D}var E=B(D,F);E._optimized=true;return E})}j(AST_Node,function(B,C){return B});AST_Node.DEFMETHOD("equivalent_to",function(B){return this.TYPE==B.TYPE&&this.print_to_string()==B.print_to_string()});AST_Scope.DEFMETHOD("process_expression",function(D,E){var B=this;var C=new TreeTransformer(function(G){if(D&&G instanceof AST_SimpleStatement){return h(AST_Return,G,{value:G.body})}if(!D&&G instanceof AST_Return){if(E){var H=G.value&&G.value.drop_side_effect_free(E,true);return H?h(AST_SimpleStatement,G,{body:H}):h(AST_EmptyStatement,G)}return h(AST_SimpleStatement,G,{body:G.value||h(AST_UnaryPrefix,G,{operator:"void",expression:h(AST_Number,G,{value:0})})})}if(G instanceof AST_Lambda&&G!==B){return G}if(G instanceof AST_Block){var F=G.body.length-1;if(F>=0){G.body[F]=G.body[F].transform(C)}}if(G instanceof AST_If){G.body=G.body.transform(C);if(G.alternative){G.alternative=G.alternative.transform(C)}}if(G instanceof AST_With){G.body=G.body.transform(C)}return G});B.transform(C)});AST_Node.DEFMETHOD("reset_opt_flags",function(E,C){var O=C&&E.option("reduce_vars");var H=Object.create(null);var B=new TreeWalker(function(P){if(!(P instanceof AST_Symbol)){return}var Q=P.definition();if(!Q){return}if(P instanceof AST_SymbolRef){Q.references.push(P)}Q.fixed=false});var G=new TreeWalker(function(T,S){T._squeezed=false;T._optimized=false;if(O){if(T instanceof AST_Toplevel){T.globals.each(K)}if(T instanceof AST_Scope){T.variables.each(K)}if(T instanceof AST_SymbolRef){var U=T.definition();U.references.push(T);if(U.fixed===undefined||!J(U)||L(T,0,M(T.fixed_value()))){U.fixed=false}else{var R=G.parent();if(R instanceof AST_Assign&&R.operator=="="&&T===R.right||R instanceof AST_Call&&T!==R.expression||R instanceof AST_Return&&T===R.value&&T.scope!==U.scope||R instanceof AST_VarDef&&T===R.value){U.escaped=true}}}if(T instanceof AST_SymbolCatch){T.definition().fixed=false}if(T instanceof AST_VarDef){var U=T.name.definition();if(U.fixed===undefined||F(U,T.value)){if(T.value){U.fixed=function(){return T.value};D(U,false);S()}else{U.fixed=null}D(U,true);return true}else{if(T.value){U.fixed=false}}}if(T instanceof AST_Assign&&T.operator=="="&&T.left instanceof AST_SymbolRef){var U=T.left.definition();if(F(U,T.right)){U.references.push(T.left);U.fixed=function(){return T.right};D(U,false);T.right.walk(G);D(U,true);return true}}if(T instanceof AST_Defun){var U=T.name.definition();if(E.exposed(U)||J(U)){U.fixed=false}else{U.fixed=T;D(U,true)}var P=H;H=Object.create(null);S();H=P;return true}if(T instanceof AST_Function){I();var Q;if(!T.name&&(Q=G.parent()) instanceof AST_Call&&Q.expression===T){T.argnames.forEach(function(V,W){var X=V.definition();if(!T.uses_arguments&&X.fixed===undefined){X.fixed=function(){return Q.args[W]||h(AST_Undefined,Q)};D(X,true)}else{X.fixed=false}})}S();N();return true}if(T instanceof AST_Accessor){var P=H;H=Object.create(null);S();H=P;return true}if(T instanceof AST_Binary&&(T.operator=="&&"||T.operator=="||")){T.left.walk(G);I();T.right.walk(G);N();return true}if(T instanceof AST_Conditional){T.condition.walk(G);I();T.consequent.walk(G);N();I();T.alternative.walk(G);N();return true}if(T instanceof AST_If){T.condition.walk(G);I();T.body.walk(G);N();if(T.alternative){I();T.alternative.walk(G);N()}return true}if(T instanceof AST_DWLoop){I();T.condition.walk(G);T.body.walk(G);N();return true}if(T instanceof AST_LabeledStatement){I();T.body.walk(G);N();return true}if(T instanceof AST_For){if(T.init){T.init.walk(G)}if(T.condition){I();T.condition.walk(G);N()}I();T.body.walk(G);N();if(T.step){I();T.step.walk(G);N()}return true}if(T instanceof AST_ForIn){T.init.walk(B);T.object.walk(G);I();T.body.walk(G);N();return true}if(T instanceof AST_Try){I();walk_body(T,G);N();if(T.bcatch){I();T.bcatch.walk(G);N()}if(T.bfinally){T.bfinally.walk(G)}return true}if(T instanceof AST_SwitchBranch){I();S();N();return true}}});this.walk(G);function D(Q,P){H[Q.id]=P}function J(P){if(H[P.id]){if(P.fixed==null){var Q=P.orig[0];if(Q instanceof AST_SymbolFunarg||Q.name=="arguments"){return false}P.fixed=h(AST_Undefined,Q)}return true}}function F(Q,P){if(!HOP(H,Q.id)){return false}if(!J(Q)){return false}if(Q.fixed===false){return false}if(Q.fixed!=null&&(!P||Q.references.length>0)){return false}return !Q.orig.some(function(R){return R instanceof AST_SymbolDefun||R instanceof AST_SymbolLambda})}function I(){H=Object.create(H)}function N(){H=Object.getPrototypeOf(H)}function K(P){P.escaped=false;if(P.scope.uses_eval){P.fixed=false}else{if(!E.exposed(P)){P.fixed=undefined}else{P.fixed=false}}P.references=[];P.should_replace=undefined}function M(P){return P&&P.is_constant()||P instanceof AST_Lambda}function L(Q,S,R){var P=G.parent(S);if(s(Q,P)||!R&&P instanceof AST_Call&&P.expression===Q){return true}else{if(P instanceof AST_PropAccess&&P.expression===Q){return !R&&L(P,S+1)}}}});AST_SymbolRef.DEFMETHOD("fixed_value",function(){var B=this.definition().fixed;if(!B||B instanceof AST_Node){return B}return B()});AST_SymbolRef.DEFMETHOD("is_immutable",function(){var B=this.definition().orig;return B.length==1&&B[0] instanceof AST_SymbolLambda});function m(B){if(B instanceof AST_SymbolRef){return B.definition().orig[0] instanceof AST_SymbolLambda}if(B instanceof AST_PropAccess){B=B.expression;if(B instanceof AST_SymbolRef){if(B.is_immutable()){return false}B=B.fixed_value()}if(!B){return true}if(B instanceof AST_RegExp){return false}if(B instanceof AST_Constant){return true}return m(B)}return false}function f(E,B){var D,C=0;while(D=E.parent(C++)){if(D instanceof AST_Scope){break}if(D instanceof AST_Catch){D=D.argname.definition().scope;break}}return D.find_variable(B)}function h(C,D,B){if(!B){B={}}if(D){if(!B.start){B.start=D.start}if(!B.end){B.end=D.end}}return new C(B)}function r(C,B){if(B.length==1){return B[0]}return h(AST_Sequence,C,{expressions:B})}function b(B,C){switch(typeof B){case"string":return h(AST_String,C,{value:B});case"number":if(isNaN(B)){return h(AST_NaN,C)}if(isFinite(B)){return 1/B<0?h(AST_UnaryPrefix,C,{operator:"-",expression:h(AST_Number,C,{value:-B})}):h(AST_Number,C,{value:B})}return B<0?h(AST_UnaryPrefix,C,{operator:"-",expression:h(AST_Infinity,C)}):h(AST_Infinity,C);case"boolean":return h(B?AST_True:AST_False,C);case"undefined":return h(AST_Undefined,C);default:if(B===null){return h(AST_Null,C,{value:null})}if(B instanceof RegExp){return h(AST_RegExp,C,{value:B})}throw new Error(string_template("Can't handle constant of type: {type}",{type:typeof B}))}}function t(B,D,C){if(B instanceof AST_UnaryPrefix&&B.operator=="delete"||B instanceof AST_Call&&B.expression===D&&(C instanceof AST_PropAccess||C instanceof AST_SymbolRef&&C.name=="eval")){return r(D,[h(AST_Number,D,{value:0}),C])}return C}function z(C,B){if(B instanceof AST_Sequence){C.push.apply(C,B.expressions)}else{C.push(B)}}function d(B){if(B===null){return[]}if(B instanceof AST_BlockStatement){return B.body}if(B instanceof AST_EmptyStatement){return[]}if(B instanceof AST_Statement){return[B]}throw new Error("Can't convert thing to statement array")}function A(B){if(B===null){return true}if(B instanceof AST_EmptyStatement){return true}if(B instanceof AST_BlockStatement){return B.body.length==0}return false}function c(B){if(B instanceof AST_Switch){return B}if(B instanceof AST_For||B instanceof AST_ForIn||B instanceof AST_DWLoop){return(B.body instanceof AST_BlockStatement?B.body:B)}return B}function i(B){if(B instanceof AST_Call&&!(B instanceof AST_New)){return B.expression instanceof AST_Function||i(B.expression)}return false}function l(G,D){var K,E=10;do{K=false;I(G);if(D.option("dead_code")){H(G,D)}if(D.option("if_return")){C(G,D)}if(D.sequences_limit>0){F(G,D)}if(D.option("join_vars")){L(G,D)}if(D.option("collapse_vars")){J(G,D)}}while(K&&E-->0);function J(ah,Y){var N=Y.find_parent(AST_Scope);if(N.uses_eval||N.uses_with){return ah}var V=[];var S=ah.length;while(--S>=0){if(S==0&&Y.option("unused")){O()}ad(ah[S]);while(V.length>0){var X=V.pop();var ac=Q(X);if(!ac||m(ac)){continue}var ab=ai(X);if(ac instanceof AST_SymbolRef){ab[ac.name]=false}var Z=T(X);var ag=X.name instanceof AST_SymbolFunarg;var R=false,W=false;var M=new TreeTransformer(function(am,al){if(R){return am}if(!ag){if(am===X){ag=true;return am}return}var ak=M.parent();if(am instanceof AST_Assign&&am.operator!="="&&ac.equivalent_to(am.left)||am instanceof AST_Call&&ac instanceof AST_PropAccess&&ac.equivalent_to(am.expression)||am instanceof AST_Debugger||am instanceof AST_IterationStatement&&!(am instanceof AST_For)||am instanceof AST_SymbolRef&&am.undeclared()||am instanceof AST_Try||am instanceof AST_With||ak instanceof AST_For&&am!==ak.init){R=true;return am}if(!(am instanceof AST_SymbolDeclaration)&&!s(am,ak)&&ac.equivalent_to(am)){K=W=R=true;Y.info("Collapsing {name} [{file}:{line},{col}]",{name:am.print_to_string(),file:am.start.file,line:am.start.line,col:am.start.col});if(X instanceof AST_UnaryPostfix){return h(AST_UnaryPrefix,X,X)}if(X instanceof AST_VarDef){var an=X.name.definition();if(an.references.length==1&&!Y.exposed(an)){return t(ak,am,X.value)}return h(AST_Assign,X,{operator:"=",left:h(AST_SymbolRef,X.name,X.name),right:X.value})}return X}var aj;if(am instanceof AST_Call||am instanceof AST_Exit||am instanceof AST_PropAccess||am instanceof AST_SymbolRef&&(ab[am.name]||Z&&!ae(am.definition()))||(aj=P(am))&&U(aj).name in ab||ak instanceof AST_Binary&&(ak.operator=="&&"||ak.operator=="||")||ak instanceof AST_Case||ak instanceof AST_Conditional||ak instanceof AST_For||ak instanceof AST_If){if(!(am instanceof AST_Scope)){al(am,M)}R=true;return am}if(am instanceof AST_Default||am instanceof AST_Scope){return am}});for(var af=S;!R&&af<ah.length;af++){ah[af].transform(M)}if(W&&!aa(X)){ah.splice(S,1)}}}function O(){var ao,an=Y.self();if(an instanceof AST_Function&&!an.name&&!an.uses_arguments&&!an.uses_eval&&(ao=Y.parent()) instanceof AST_Call&&ao.expression===an){var ap=Object.create(null);for(var am=an.argnames.length;--am>=0;){var al=an.argnames[am];if(al.name in ap){continue}ap[al.name]=true;var aj=ao.args[am];if(!aj){aj=h(AST_Undefined,al)}else{var ak=new TreeWalker(function(ar){if(!aj){return true}if(ar instanceof AST_SymbolRef&&an.variables.has(ar.name)){var aq=ar.definition().scope;if(aq!==N){while(aq=aq.parent_scope){if(aq===N){return true}}}aj=null}if(ar instanceof AST_This&&!ak.find_parent(AST_Scope)){aj=null;return true}});aj.walk(ak)}if(aj){V.unshift(h(AST_VarDef,al,{name:al,value:aj}))}}}}function ad(aj){if(aj instanceof AST_Assign&&!aj.left.has_side_effects(Y)||aj instanceof AST_Unary&&(aj.operator=="++"||aj.operator=="--")){V.push(aj)}else{if(aj instanceof AST_Sequence){aj.expressions.forEach(ad)}else{if(aj instanceof AST_Definitions){aj.definitions.forEach(function(ak){if(ak.value){V.push(ak)}})}else{if(aj instanceof AST_SimpleStatement){ad(aj.body)}else{if(aj instanceof AST_For&&aj.init){ad(aj.init)}}}}}}function Q(ak){if(ak instanceof AST_VarDef){var aj=ak.name.definition();if(aj.orig.length>1&&!(ak.name instanceof AST_SymbolFunarg)||aj.references.length==1&&!Y.exposed(aj)){return h(AST_SymbolRef,ak.name,ak.name)}}else{return ak[ak instanceof AST_Assign?"left":"expression"]}}function U(aj){while(aj instanceof AST_PropAccess){aj=aj.expression}return aj}function ai(am){var aj=Object.create(null);if(am instanceof AST_Unary){return aj}var al;var ak=new TreeWalker(function(aq,ap){if(aq instanceof AST_Scope){var ao=al;ap();al=ao;return true}if(aq instanceof AST_SymbolRef||aq instanceof AST_PropAccess){var an=U(aq);if(an instanceof AST_SymbolRef){aj[an.name]=aj[an.name]||s(aq,ak.parent())}}});am[am instanceof AST_Assign?"right":"value"].walk(ak);return aj}function P(aj){if(aj instanceof AST_VarDef){return aj.value&&aj.name}return s(aj.left,aj)}function aa(am){if(am.name instanceof AST_SymbolFunarg){var ak=Y.self().argnames.indexOf(am.name);var aj=Y.parent().args;if(aj[ak]){aj[ak]=h(AST_Number,aj[ak],{value:0})}return true}var al=false;return ah[S].transform(new TreeTransformer(function(ap,an,ao){if(al){return ap}if(ap===am){al=true;if(ap instanceof AST_VarDef){remove(ap.name.definition().orig,ap.name)}return ao?MAP.skip:null}},function(an){if(an instanceof AST_Sequence){switch(an.expressions.length){case 0:return null;case 1:return an.expressions[0]}}if(an instanceof AST_Definitions&&an.definitions.length==0||an instanceof AST_SimpleStatement&&!an.body){return null}}))}function T(aj){if(aj instanceof AST_Unary){return false}return aj[aj instanceof AST_Assign?"right":"value"].has_side_effects(Y)}function ae(aj){if(aj.orig.length==1&&aj.orig[0] instanceof AST_SymbolDefun){return true}if(aj.scope!==N){return false}return aj.references.every(function(ak){return ak.scope===N})}}function I(N){var M=[];for(var O=0;O<N.length;){var P=N[O];if(P instanceof AST_BlockStatement){K=true;I(P.body);[].splice.apply(N,[O,1].concat(P.body));O+=P.body.length}else{if(P instanceof AST_EmptyStatement){K=true;N.splice(O,1)}else{if(P instanceof AST_Directive){if(M.indexOf(P.value)<0){O++;M.push(P.value)}else{K=true;N.splice(O,1)}}else{O++}}}}}function C(W,Q){var ac=Q.self();var M=N(W);var Y=ac instanceof AST_Lambda;for(var S=W.length;--S>=0;){var R=W[S];var T=W[S+1];if(Y&&R instanceof AST_Return&&!R.value&&!T){K=true;W.length--;continue}if(R instanceof AST_If){var ad=y(R.body);if(X(ad)){if(ad.label){remove(ad.label.thedef.references,ad)}K=true;R=R.clone();R.condition=R.condition.negate(Q);var U=V(R.body,ad);R.body=h(AST_BlockStatement,R,{body:d(R.alternative).concat(Z())});R.alternative=h(AST_BlockStatement,R,{body:U});W[S]=R.transform(Q);continue}var ad=y(R.alternative);if(X(ad)){if(ad.label){remove(ad.label.thedef.references,ad)}K=true;R=R.clone();R.body=h(AST_BlockStatement,R.body,{body:d(R.body).concat(Z())});var U=V(R.alternative,ad);R.alternative=h(AST_BlockStatement,R.alternative,{body:U});W[S]=R.transform(Q);continue}}if(R instanceof AST_If&&R.body instanceof AST_Return){var aa=R.body.value;if(!aa&&!R.alternative&&(Y&&!T||T instanceof AST_Return&&!T.value)){K=true;W[S]=h(AST_SimpleStatement,R.condition,{body:R.condition});continue}if(aa&&!R.alternative&&T instanceof AST_Return&&T.value){K=true;R=R.clone();R.alternative=T;W.splice(S,2,R.transform(Q));continue}if(M&&Y&&aa&&!R.alternative&&(!T||T instanceof AST_Return)){K=true;R=R.clone();R.alternative=T||h(AST_Return,R,{value:null});W.splice(S,T?2:1,R.transform(Q));continue}var O=W[S-1];if(Q.option("sequences")&&Y&&!R.alternative&&O instanceof AST_If&&O.body instanceof AST_Return&&S+2==W.length&&T instanceof AST_SimpleStatement){K=true;W.push(h(AST_Return,T,{value:null}).transform(Q));continue}}}function N(ab){var ag=0;for(var ae=ab.length;--ae>=0;){var af=ab[ae];if(af instanceof AST_If&&af.body instanceof AST_Return){if(++ag>1){return true}}}return false}function P(ab){return !ab||ab instanceof AST_UnaryPrefix&&ab.operator=="void"}function X(af){if(!af){return false}var ae=af instanceof AST_LoopControl?Q.loopcontrol_target(af):null;return af instanceof AST_Return&&Y&&P(af.value)||af instanceof AST_Continue&&ac===c(ae)||af instanceof AST_Break&&ae instanceof AST_BlockStatement&&ac===ae}function Z(){var ab=W.slice(S+1);W.length=S+1;return ab.filter(function(ae){if(ae instanceof AST_Defun){W.push(ae);return false}return true})}function V(af,ag){var ae=d(af).slice(0,-1);if(ag.value){ae.push(h(AST_SimpleStatement,ag.value,{body:ag.value.expression}))}return ae}}function H(R,N){var Q;var T=N.self();for(var P=0,M=0,S=R.length;P<S;P++){var O=R[P];if(O instanceof AST_LoopControl){var U=N.loopcontrol_target(O);if(O instanceof AST_Break&&!(U instanceof AST_IterationStatement)&&c(U)===T||O instanceof AST_Continue&&c(U)===T){if(O.label){remove(O.label.thedef.references,O)}}else{R[M++]=O}}else{R[M++]=O}if(y(O)){Q=R.slice(P+1);break}}R.length=M;K=M!=S;if(Q){Q.forEach(function(V){e(N,V,R)})}}function F(R,N){if(R.length<2){return}var U=[],M=0;function T(){if(!U.length){return}var V=r(U[0],U);R[M++]=h(AST_SimpleStatement,V,{body:V});U=[]}for(var P=0,S=R.length;P<S;P++){var O=R[P];if(O instanceof AST_SimpleStatement){if(U.length>=N.sequences_limit){T()}var Q=O.body;if(U.length>0){Q=Q.drop_side_effect_free(N)}if(Q){z(U,Q)}}else{T();R[M++]=O}}T();R.length=M;B(R,N);K=R.length!=S}function B(T,Q){function O(V){M--;var W=N.body;if(!(W instanceof AST_Sequence)){W=h(AST_Sequence,W,{expressions:[W]})}z(W.expressions,V);return W.transform(Q)}var M=0,N;for(var S=0,U=T.length;S<U;S++){var R=T[S];if(N){if(R instanceof AST_For&&!(R.init instanceof AST_Definitions)){var P=false;N.body.walk(new TreeWalker(function(V){if(P||V instanceof AST_Scope){return true}if(V instanceof AST_Binary&&V.operator=="in"){P=true;return true}}));if(!P){if(R.init){R.init=O(R.init)}else{R.init=N.body.drop_side_effect_free(Q);M--}}}else{if(R instanceof AST_If){R.condition=O(R.condition)}else{if(R instanceof AST_With){R.expression=O(R.expression)}else{if(R instanceof AST_Exit&&R.value){R.value=O(R.value)}else{if(R instanceof AST_Exit){R.value=O(h(AST_Undefined,R).transform(Q))}else{if(R instanceof AST_Switch){R.expression=O(R.expression)}}}}}}}T[M++]=R;N=R instanceof AST_SimpleStatement?R:null}T.length=M}function L(N,S){for(var P=0,O=-1,M=N.length;P<M;P++){var Q=N[P];var R=N[O];if(Q instanceof AST_Definitions&&R&&R.TYPE==Q.TYPE){R.definitions=R.definitions.concat(Q.definitions);K=true}else{if(Q instanceof AST_For&&R instanceof AST_Var&&(!Q.init||Q.init.TYPE==R.TYPE)){K=true;if(Q.init){Q.init.definitions=R.definitions.concat(Q.init.definitions)}else{Q.init=R}N[O]=Q}else{N[++O]=Q}}}N.length=O+1}}function e(D,B,C){if(!(B instanceof AST_Defun)){D.warn("Dropping unreachable code [{file}:{line},{col}]",B.start)}B.walk(new TreeWalker(function(E){if(E instanceof AST_Definitions){D.warn("Declarations in unreachable code! [{file}:{line},{col}]",E.start);E.remove_initializers();C.push(E);return true}if(E instanceof AST_Defun&&(E===B||!D.has_directive("use strict"))){C.push(E);return true}if(E instanceof AST_Scope){return true}}))}function v(B,C){return B.is_undefined||B instanceof AST_Undefined||B instanceof AST_UnaryPrefix&&B.operator=="void"&&!B.expression.has_side_effects(C)}(function(C){AST_Node.DEFMETHOD("may_throw_on_access",function(E){var D=E.option("pure_getters");return !D||this._throw_on_access(D)});function B(D){return/strict/.test(D)}C(AST_Node,B);C(AST_Null,return_true);C(AST_Undefined,return_true);C(AST_Constant,return_false);C(AST_Array,return_false);C(AST_Object,function(E){if(!B(E)){return false}for(var D=this.properties.length;--D>=0;){if(this.properties[D].value instanceof AST_Accessor){return true}}return false});C(AST_Function,return_false);C(AST_UnaryPostfix,return_false);C(AST_UnaryPrefix,function(){return this.operator=="void"});C(AST_Binary,function(D){switch(this.operator){case"&&":return this.left._throw_on_access(D);case"||":return this.left._throw_on_access(D)&&this.right._throw_on_access(D);default:return false}});C(AST_Assign,function(D){return this.operator=="="&&this.right._throw_on_access(D)});C(AST_Conditional,function(D){return this.consequent._throw_on_access(D)||this.alternative._throw_on_access(D)});C(AST_Sequence,function(D){return this.expressions[this.expressions.length-1]._throw_on_access(D)});C(AST_SymbolRef,function(E){if(this.is_undefined){return true}if(!B(E)){return false}if(this.is_immutable()){return false}var D=this.fixed_value();return !D||D._throw_on_access(E)})})(function(C,B){C.DEFMETHOD("_throw_on_access",B)});(function(C){var B=["!","delete"];var D=["in","instanceof","==","!=","===","!==","<","<=",">=",">"];C(AST_Node,return_false);C(AST_UnaryPrefix,function(){return member(this.operator,B)});C(AST_Binary,function(){return member(this.operator,D)||((this.operator=="&&"||this.operator=="||")&&this.left.is_boolean()&&this.right.is_boolean())});C(AST_Conditional,function(){return this.consequent.is_boolean()&&this.alternative.is_boolean()});C(AST_Assign,function(){return this.operator=="="&&this.right.is_boolean()});C(AST_Sequence,function(){return this.expressions[this.expressions.length-1].is_boolean()});C(AST_True,return_true);C(AST_False,return_true)})(function(C,B){C.DEFMETHOD("is_boolean",B)});(function(C){C(AST_Node,return_false);C(AST_Number,return_true);var B=makePredicate("+ - ~ ++ --");C(AST_Unary,function(){return B(this.operator)});var D=makePredicate("- * / % & | ^ << >> >>>");C(AST_Binary,function(E){return D(this.operator)||this.operator=="+"&&this.left.is_number(E)&&this.right.is_number(E)});C(AST_Assign,function(E){return D(this.operator.slice(0,-1))||this.operator=="="&&this.right.is_number(E)});C(AST_Sequence,function(E){return this.expressions[this.expressions.length-1].is_number(E)});C(AST_Conditional,function(E){return this.consequent.is_number(E)&&this.alternative.is_number(E)})})(function(C,B){C.DEFMETHOD("is_number",B)});(function(B){B(AST_Node,return_false);B(AST_String,return_true);B(AST_UnaryPrefix,function(){return this.operator=="typeof"});B(AST_Binary,function(C){return this.operator=="+"&&(this.left.is_string(C)||this.right.is_string(C))});B(AST_Assign,function(C){return(this.operator=="="||this.operator=="+=")&&this.right.is_string(C)});B(AST_Sequence,function(C){return this.expressions[this.expressions.length-1].is_string(C)});B(AST_Conditional,function(C){return this.consequent.is_string(C)&&this.alternative.is_string(C)})})(function(C,B){C.DEFMETHOD("is_string",B)});var q=makePredicate("delete ++ --");function s(C,B){if(B instanceof AST_Unary&&q(B.operator)){return B.expression}if(B instanceof AST_Assign&&B.left===C){return C}}(function(C){AST_Node.DEFMETHOD("resolve_defines",function(H){if(!H.option("global_defs")){return}var F=this._find_defs(H,"");if(F){var E,D=this,G=0;do{E=D;D=H.parent(G++)}while(D instanceof AST_PropAccess&&D.expression===E);if(s(E,D)){H.warn("global_defs "+this.print_to_string()+" redefined [{file}:{line},{col}]",this.start)}else{return F}}});function B(F,G){if(F instanceof AST_Node){return h(F.CTOR,G,F)}if(Array.isArray(F)){return h(AST_Array,G,{elements:F.map(function(H){return B(H,G)})})}if(F&&typeof F=="object"){var E=[];for(var D in F){if(HOP(F,D)){E.push(h(AST_ObjectKeyVal,G,{key:D,value:B(F[D],G)}))}}return h(AST_Object,G,{properties:E})}return b(F,G)}C(AST_Node,noop);C(AST_Dot,function(E,D){return this.expression._find_defs(E,"."+this.property+D)});C(AST_SymbolRef,function(I,H){if(!this.global()){return}var D;var E=I.option("global_defs");if(E&&HOP(E,(D=this.name+H))){var F=B(E[D],this);var G=I.find_parent(AST_Toplevel);F.walk(new TreeWalker(function(J){if(J instanceof AST_SymbolRef){J.scope=G;J.thedef=G.def_global(J)}}));return F}})})(function(C,B){C.DEFMETHOD("_find_defs",B)});function a(C,B){return C.print_to_string().length>B.print_to_string().length?B:C}function k(C,B){return a(h(AST_SimpleStatement,C,{body:C}),h(AST_SimpleStatement,B,{body:B})).body}function p(D,C,B){return(first_in_statement(D)?k:a)(C,B)}(function(C){AST_Node.DEFMETHOD("evaluate",function(L){if(!L.option("evaluate")){return this}var K=this._eval(L);return !K||K instanceof RegExp||typeof K!="object"?K:this});var E=makePredicate("! ~ - + void");AST_Node.DEFMETHOD("is_constant",function(){if(this instanceof AST_Constant){return !(this instanceof AST_RegExp)}else{return this instanceof AST_UnaryPrefix&&this.expression instanceof AST_Constant&&E(this.operator)}});AST_Node.DEFMETHOD("constant_value",function(L){if(this instanceof AST_Constant&&!(this instanceof AST_RegExp)){return this.value}if(this instanceof AST_UnaryPrefix&&this.expression instanceof AST_Constant){switch(this.operator){case"!":return !this.expression.value;case"~":return ~this.expression.value;case"-":return -this.expression.value;case"+":return +this.expression.value;default:throw new Error(string_template("Cannot evaluate unary expression {value}",{value:this.print_to_string()}))}}var K=this.evaluate(L);if(K!==this){return K}throw new Error(string_template("Cannot evaluate constant [{file}:{line},{col}]",this.start))});C(AST_Statement,function(){throw new Error(string_template("Cannot evaluate a statement [{file}:{line},{col}]",this.start))});C(AST_Lambda,return_this);function G(K,L){if(!L){throw new Error("Compressor must be passed")}return K._eval(L)}C(AST_Node,return_this);C(AST_Constant,function(){return this.getValue()});C(AST_Array,function(P){if(P.option("unsafe")){var O=[];for(var M=0,K=this.elements.length;M<K;M++){var L=this.elements[M];var N=G(L,P);if(L===N){return this}O.push(N)}return O}return this});C(AST_Object,function(P){if(P.option("unsafe")){var N={};for(var M=0,K=this.properties.length;M<K;M++){var O=this.properties[M];var L=O.key;if(L instanceof AST_Symbol){L=L.name}else{if(L instanceof AST_Node){L=G(L,P);if(L===O.key){return this}}}if(typeof Object.prototype[L]==="function"){return this}N[L]=G(O.value,P);if(N[L]===O.value){return this}}return N}return this});C(AST_UnaryPrefix,function(L){if(this.operator=="typeof"&&this.expression instanceof AST_Function){return typeof function(){}}var K=G(this.expression,L);if(K===this.expression){return this}switch(this.operator){case"!":return !K;case"typeof":if(K instanceof RegExp){return this}return typeof K;case"void":return void K;case"~":return ~K;case"-":return -K;case"+":return +K}return this});C(AST_Binary,function(N){var M=G(this.left,N);if(M===this.left){return this}var L=G(this.right,N);if(L===this.right){return this}var K;switch(this.operator){case"&&":K=M&&L;break;case"||":K=M||L;break;case"|":K=M|L;break;case"&":K=M&L;break;case"^":K=M^L;break;case"+":K=M+L;break;case"*":K=M*L;break;case"/":K=M/L;break;case"%":K=M%L;break;case"-":K=M-L;break;case"<<":K=M<<L;break;case">>":K=M>>L;break;case">>>":K=M>>>L;break;case"==":K=M==L;break;case"===":K=M===L;break;case"!=":K=M!=L;break;case"!==":K=M!==L;break;case"<":K=M<L;break;case"<=":K=M<=L;break;case">":K=M>L;break;case">=":K=M>=L;break;default:return this}if(isNaN(K)&&N.find_parent(AST_With)){return this}return K});C(AST_Conditional,function(N){var M=G(this.condition,N);if(M===this.condition){return this}var K=M?this.consequent:this.alternative;var L=G(K,N);return L===K?this:L});C(AST_SymbolRef,function(M){if(!M.option("reduce_vars")){return this}var K=this.fixed_value();if(!K){return this}this._eval=return_this;var L=G(K,M);if(L===K){delete this._eval;return this}if(!HOP(K,"_eval")){K._eval=function(){return L}}if(L&&typeof L=="object"&&this.definition().escaped){delete this._eval;return this}this._eval=K._eval;return L});var H={Array:Array,Boolean:Boolean,Math:Math,Number:Number,RegExp:RegExp,Object:Object,String:String};function B(L){for(var K in L){L[K]=makePredicate(L[K])}}var J={Math:["E","LN10","LN2","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],Number:["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"]};B(J);C(AST_PropAccess,function(N){if(N.option("unsafe")){var K=this.property;if(K instanceof AST_Node){K=G(K,N);if(K===this.property){return this}}var M=this.expression;var L;if(M instanceof AST_SymbolRef&&M.undeclared()){if(!(J[M.name]||return_false)(K)){return this}L=H[M.name]}else{L=G(M,N);if(!L||L===M||!HOP(L,K)){return this}}return L[K]}return this});var D=["constructor","toString","valueOf"];var I={Array:["indexOf","join","lastIndexOf","slice"].concat(D),Boolean:D,Number:["toExponential","toFixed","toPrecision"].concat(D),RegExp:["test"].concat(D),String:["charAt","charCodeAt","concat","indexOf","italics","lastIndexOf","match","replace","search","slice","split","substr","substring","trim"].concat(D)};B(I);var F={Array:["isArray"],Math:["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","atan2","pow","max","min"],Number:["isFinite","isNaN"],Object:["keys","getOwnPropertyNames"],String:["fromCharCode"]};B(F);C(AST_Call,function(M){var L=this.expression;if(M.option("unsafe")&&L instanceof AST_PropAccess){var S=L.property;if(S instanceof AST_Node){S=G(S,M);if(S===L.property){return this}}var K;var P=L.expression;if(P instanceof AST_SymbolRef&&P.undeclared()){if(!(F[P.name]||return_false)(S)){return this}K=H[P.name]}else{K=G(P,M);if(K===P||!(K&&I[K.constructor.name]||return_false)(S)){return this}}var Q=[];for(var N=0,O=this.args.length;N<O;N++){var T=this.args[N];var R=G(T,M);if(T===R){return this}Q.push(R)}return K[S].apply(K,Q)}return this});C(AST_New,return_this)})(function(C,B){C.DEFMETHOD("_eval",B)});(function(C){function B(E){return h(AST_UnaryPrefix,E,{operator:"!",expression:E})}function D(I,G,F){var H=B(I);if(F){var E=h(AST_SimpleStatement,G,{body:G});return a(H,E)===E?G:H}return a(H,G)}C(AST_Node,function(){return B(this)});C(AST_Statement,function(){throw new Error("Cannot negate a statement")});C(AST_Function,function(){return B(this)});C(AST_UnaryPrefix,function(){if(this.operator=="!"){return this.expression}return B(this)});C(AST_Sequence,function(F){var E=this.expressions.slice();E.push(E.pop().negate(F));return r(this,E)});C(AST_Conditional,function(G,F){var E=this.clone();E.consequent=E.consequent.negate(G);E.alternative=E.alternative.negate(G);return D(this,E,F)});C(AST_Binary,function(H,F){var E=this.clone(),G=this.operator;if(H.option("unsafe_comps")){switch(G){case"<=":E.operator=">";return E;case"<":E.operator=">=";return E;case">=":E.operator="<";return E;case">":E.operator="<=";return E}}switch(G){case"==":E.operator="!=";return E;case"!=":E.operator="==";return E;case"===":E.operator="!==";return E;case"!==":E.operator="===";return E;case"&&":E.operator="||";E.left=E.left.negate(H,F);E.right=E.right.negate(H);return D(this,E,F);case"||":E.operator="&&";E.left=E.left.negate(H,F);E.right=E.right.negate(H);return D(this,E,F)}return B(this)})})(function(C,B){C.DEFMETHOD("negate",function(E,D){return B.call(this,E,D)})});AST_Call.DEFMETHOD("has_pure_annotation",function(E){if(!E.option("side_effects")){return false}if(this.pure!==undefined){return this.pure}var B=false;var D,C;if(this.start&&(D=this.start.comments_before)&&D.length&&/[@#]__PURE__/.test((C=D[D.length-1]).value)){B=C}return this.pure=B});(function(C){C(AST_Node,return_true);C(AST_EmptyStatement,return_false);C(AST_Constant,return_false);C(AST_This,return_false);C(AST_Call,function(E){if(!this.has_pure_annotation(E)&&E.pure_funcs(this)){return true}for(var D=this.args.length;--D>=0;){if(this.args[D].has_side_effects(E)){return true}}return false});function B(E,F){for(var D=E.length;--D>=0;){if(E[D].has_side_effects(F)){return true}}return false}C(AST_Block,function(D){return B(this.body,D)});C(AST_Switch,function(D){return this.expression.has_side_effects(D)||B(this.body,D)});C(AST_Case,function(D){return this.expression.has_side_effects(D)||B(this.body,D)});C(AST_Try,function(D){return B(this.body,D)||this.bcatch&&this.bcatch.has_side_effects(D)||this.bfinally&&this.bfinally.has_side_effects(D)});C(AST_If,function(D){return this.condition.has_side_effects(D)||this.body&&this.body.has_side_effects(D)||this.alternative&&this.alternative.has_side_effects(D)});C(AST_LabeledStatement,function(D){return this.body.has_side_effects(D)});C(AST_SimpleStatement,function(D){return this.body.has_side_effects(D)});C(AST_Defun,return_true);C(AST_Function,return_false);C(AST_Binary,function(D){return this.left.has_side_effects(D)||this.right.has_side_effects(D)});C(AST_Assign,return_true);C(AST_Conditional,function(D){return this.condition.has_side_effects(D)||this.consequent.has_side_effects(D)||this.alternative.has_side_effects(D)});C(AST_Unary,function(D){return q(this.operator)||this.expression.has_side_effects(D)});C(AST_SymbolRef,function(D){return this.undeclared()});C(AST_SymbolDeclaration,return_false);C(AST_Object,function(D){return B(this.properties,D)});C(AST_ObjectProperty,function(D){return this.value.has_side_effects(D)});C(AST_Array,function(D){return B(this.elements,D)});C(AST_Dot,function(D){return this.expression.may_throw_on_access(D)||this.expression.has_side_effects(D)});C(AST_Sub,function(D){return this.expression.may_throw_on_access(D)||this.expression.has_side_effects(D)||this.property.has_side_effects(D)});C(AST_Sequence,function(D){return this.expressions.some(function(F,E){return F.has_side_effects(D)})})})(function(C,B){C.DEFMETHOD("has_side_effects",B)});(function(C){function B(E){for(var D=E.length;--D>=0;){if(!E[D].is_constant_expression()){return false}}return true}C(AST_Node,return_false);C(AST_Constant,return_true);C(AST_Unary,function(){return this.expression.is_constant_expression()});C(AST_Binary,function(){return this.left.is_constant_expression()&&this.right.is_constant_expression()});C(AST_Array,function(){return B(this.elements)});C(AST_Object,function(){return B(this.properties)});C(AST_ObjectProperty,function(){return this.value.is_constant_expression()})})(function(C,B){C.DEFMETHOD("is_constant_expression",B)});function y(B){return B&&B.aborts()}(function(B){B(AST_Statement,return_null);B(AST_Jump,return_this);function C(){var D=this.body.length;return D>0&&y(this.body[D-1])}B(AST_BlockStatement,C);B(AST_SwitchBranch,C);B(AST_If,function(){return this.alternative&&y(this.body)&&y(this.alternative)&&this})})(function(C,B){C.DEFMETHOD("aborts",B)});j(AST_Directive,function(B,C){if(C.has_directive(B.value)!==B){return h(AST_EmptyStatement,B)}return B});j(AST_Debugger,function(B,C){if(C.option("drop_debugger")){return h(AST_EmptyStatement,B)}return B});j(AST_LabeledStatement,function(B,C){if(B.body instanceof AST_Break&&C.loopcontrol_target(B.body)===B.body){return h(AST_EmptyStatement,B)}return B.label.references.length==0?B.body:B});j(AST_Block,function(B,C){l(B.body,C);return B});j(AST_BlockStatement,function(B,C){l(B.body,C);switch(B.body.length){case 1:return B.body[0];case 0:return h(AST_EmptyStatement,B)}return B});AST_Scope.DEFMETHOD("drop_unused",function(C){if(!C.option("unused")){return}if(C.has_directive("use asm")){return}var O=this;if(O.uses_eval||O.uses_with){return}var D=!(O instanceof AST_Toplevel)||C.toplevel.funcs;var H=!(O instanceof AST_Toplevel)||C.toplevel.vars;if(!D&&!H){return}var K=!/keep_assign/.test(C.option("unused"));var M=[];var L=Object.create(null);if(O instanceof AST_Toplevel&&C.top_retain){O.variables.each(function(P){if(C.top_retain(P)&&!(P.id in L)){L[P.id]=true;M.push(P)}})}var I=new Dictionary();var F=new Dictionary();var N=this;var E=new TreeWalker(function(R,Q){if(R!==O){if(R instanceof AST_Defun){if(!D&&N===O){var S=R.name.definition();if(!(S.id in L)){L[S.id]=true;M.push(S)}}F.add(R.name.name,R);return true}if(R instanceof AST_Definitions&&N===O){R.definitions.forEach(function(U){var T=U.name.definition();if(U.name instanceof AST_SymbolVar){I.add(T.id,U)}if(!H){if(!(T.id in L)){L[T.id]=true;M.push(T)}}if(U.value){F.add(U.name.name,U.value);if(U.value.has_side_effects(C)){U.value.walk(E)}}});return true}if(K&&R instanceof AST_Assign&&R.operator=="="&&R.left instanceof AST_SymbolRef&&N===O){R.right.walk(E);return true}if(R instanceof AST_SymbolRef){var S=R.definition();if(!(S.id in L)){L[S.id]=true;M.push(S)}return true}if(R instanceof AST_Scope){var P=N;N=R;Q();N=P;return true}}});O.walk(E);for(var B=0;B<M.length;++B){M[B].orig.forEach(function(P){var Q=F.get(P.name);if(Q){Q.forEach(function(S){var R=new TreeWalker(function(T){if(T instanceof AST_SymbolRef){var U=T.definition();if(!(U.id in L)){L[U.id]=true;M.push(U)}}});S.walk(R)})}})}var G=new TreeTransformer(function J(S,Z,ad){if(S instanceof AST_Function&&S.name&&!C.option("keep_fnames")){var Q=S.name.definition();if(!(Q.id in L)||Q.orig.length>1){S.name=null}}if(S instanceof AST_Lambda&&!(S instanceof AST_Accessor)){var T=!C.option("keep_fargs");for(var ab=S.argnames,V=ab.length;--V>=0;){var R=ab[V];if(!(R.definition().id in L)){R.__unused=true;if(T){ab.pop();C[R.unreferenced()?"warn":"info"]("Dropping unused function argument {name} [{file}:{line},{col}]",ac(R))}}else{T=false}}}if(D&&S instanceof AST_Defun&&S!==O){if(!(S.name.definition().id in L)){C[S.name.unreferenced()?"warn":"info"]("Dropping unused function {name} [{file}:{line},{col}]",ac(S.name));return h(AST_EmptyStatement,S)}return S}if(H&&S instanceof AST_Definitions&&!(G.parent() instanceof AST_ForIn&&G.parent().init===S)){var W=[],aa=[],Y=[];var P=[];S.definitions.forEach(function(ah){if(ah.value){ah.value=ah.value.transform(G)}var ae=ah.name.definition();if(ae.id in L){if(ah.name instanceof AST_SymbolVar){var af=I.get(ae.id);if(af.length>1&&!ah.value){C.warn("Dropping duplicated definition of variable {name} [{file}:{line},{col}]",ac(ah.name));remove(af,ah);remove(ae.orig,ah.name);return}}if(ah.value){if(P.length>0){if(Y.length>0){z(P,ah.value);ah.value=r(ah.value,P)}else{W.push(h(AST_SimpleStatement,S,{body:r(S,P)}))}P=[]}Y.push(ah)}else{aa.push(ah)}}else{if(ae.orig[0] instanceof AST_SymbolCatch){var ag=ah.value&&ah.value.drop_side_effect_free(C);if(ag){z(P,ag)}ah.value=null;aa.push(ah)}else{var ag=ah.value&&ah.value.drop_side_effect_free(C);if(ag){C.warn("Side effects in initialization of unused variable {name} [{file}:{line},{col}]",ac(ah.name));z(P,ag)}else{C[ah.name.unreferenced()?"warn":"info"]("Dropping unused variable {name} [{file}:{line},{col}]",ac(ah.name))}remove(ae.orig,ah.name)}}});if(aa.length==0&&Y.length==1&&Y[0].name instanceof AST_SymbolVar){var X=I.get(Y[0].name.definition().id);if(X.length>1){var Q=Y.pop();C.warn("Converting duplicated definition of variable {name} to assignment [{file}:{line},{col}]",ac(Q.name));remove(X,Q);remove(Q.name.definition().orig,Q.name);P.unshift(h(AST_Assign,Q,{operator:"=",left:h(AST_SymbolRef,Q.name,Q.name),right:Q.value}))}}if(aa.length>0||Y.length>0){S.definitions=aa.concat(Y);W.push(S)}if(P.length>0){W.push(h(AST_SimpleStatement,S,{body:r(S,P)}))}switch(W.length){case 0:return ad?MAP.skip:h(AST_EmptyStatement,S);case 1:return W[0];default:return ad?MAP.splice(W):h(AST_BlockStatement,S,{body:W})}}if(H&&K&&S instanceof AST_Assign&&S.operator=="="&&S.left instanceof AST_SymbolRef){var Q=S.left.definition();if(!(Q.id in L)&&O.variables.get(Q.name)===Q){return t(G.parent(),S,S.right.transform(G))}}if(S instanceof AST_For){Z(S,this);if(S.init instanceof AST_BlockStatement){var U=S.init;S.init=U.body.pop();U.body.push(S);return ad?MAP.splice(U.body):U}else{if(S.init instanceof AST_SimpleStatement){S.init=S.init.body}else{if(A(S.init)){S.init=null}}}return S}if(S instanceof AST_LabeledStatement&&S.body instanceof AST_For){Z(S,this);if(S.body instanceof AST_BlockStatement){var U=S.body;S.body=U.body.pop();U.body.push(S);return ad?MAP.splice(U.body):U}return S}if(S instanceof AST_Scope&&S!==O){return S}function ac(ae){return{name:ae.name,file:ae.start.file,line:ae.start.line,col:ae.start.col}}});O.transform(G)});AST_Scope.DEFMETHOD("hoist_declarations",function(J){var M=this;if(J.has_directive("use asm")){return M}var P=J.option("hoist_funs");var F=J.option("hoist_vars");if(P||F){var E=[];var Q=[];var N=new Dictionary(),L=0,G=0;M.walk(new TreeWalker(function(T){if(T instanceof AST_Scope&&T!==M){return true}if(T instanceof AST_Var){++G;return true}}));F=F&&G>1;var B=new TreeTransformer(function I(U){if(U!==M){if(U instanceof AST_Directive){E.push(U);return h(AST_EmptyStatement,U)}if(P&&U instanceof AST_Defun&&(B.parent()===M||!J.has_directive("use strict"))){Q.push(U);return h(AST_EmptyStatement,U)}if(F&&U instanceof AST_Var){U.definitions.forEach(function(X){N.set(X.name.name,X);++L});var T=U.to_assignments(J);var W=B.parent();if(W instanceof AST_ForIn&&W.init===U){if(T==null){var V=U.definitions[0].name;return h(AST_SymbolRef,V,V)}return T}if(W instanceof AST_For&&W.init===U){return T}if(!T){return h(AST_EmptyStatement,U)}return h(AST_SimpleStatement,U,{body:T})}if(U instanceof AST_Scope){return U}}});M=M.transform(B);if(L>0){var C=[];N.each(function(U,T){if(M instanceof AST_Lambda&&find_if(function(V){return V.name==U.name.name},M.argnames)){N.del(T)}else{U=U.clone();U.value=null;C.push(U);N.set(T,U)}});if(C.length>0){for(var R=0;R<M.body.length;){if(M.body[R] instanceof AST_SimpleStatement){var D=M.body[R].body,H,O;if(D instanceof AST_Assign&&D.operator=="="&&(H=D.left) instanceof AST_Symbol&&N.has(H.name)){var K=N.get(H.name);if(K.value){break}K.value=D.right;remove(C,K);C.push(K);M.body.splice(R,1);continue}if(D instanceof AST_Sequence&&(O=D.expressions[0]) instanceof AST_Assign&&O.operator=="="&&(H=O.left) instanceof AST_Symbol&&N.has(H.name)){var K=N.get(H.name);if(K.value){break}K.value=O.right;remove(C,K);C.push(K);M.body[R].body=r(D,D.expressions.slice(1));continue}}if(M.body[R] instanceof AST_EmptyStatement){M.body.splice(R,1);continue}if(M.body[R] instanceof AST_BlockStatement){var S=[R,1].concat(M.body[R].body);M.body.splice.apply(M.body,S);continue}break}C=h(AST_Var,M,{definitions:C});Q.push(C)}}M.body=E.concat(Q,M.body)}return M});(function(C){function B(E,K,I){var D=E.length;if(!D){return null}var F=[],J=false;for(var G=0;G<D;G++){var H=E[G].drop_side_effect_free(K,I);J|=H!==E[G];if(H){z(F,H);I=false}}return J?F.length?F:null:E}C(AST_Node,return_this);C(AST_Constant,return_null);C(AST_This,return_null);C(AST_Call,function(G,F){if(!this.has_pure_annotation(G)&&G.pure_funcs(this)){if(this.expression instanceof AST_Function&&(!this.expression.name||!this.expression.name.definition().references.length)){var E=this.clone();E.expression.process_expression(false,G);return E}return this}if(this.pure){G.warn("Dropping __PURE__ call [{file}:{line},{col}]",this.start);this.pure.value=this.pure.value.replace(/[@#]__PURE__/g," ")}var D=B(this.args,G,F);return D&&r(this,D)});C(AST_Accessor,return_null);C(AST_Function,return_null);C(AST_Binary,function(H,F){var D=this.right.drop_side_effect_free(H);if(!D){return this.left.drop_side_effect_free(H,F)}switch(this.operator){case"&&":case"||":if(D===this.right){return this}var E=this.clone();E.right=D;return E;default:var G=this.left.drop_side_effect_free(H,F);if(!G){return this.right.drop_side_effect_free(H,F)}return r(this,[G,D])}});C(AST_Assign,return_this);C(AST_Conditional,function(G){var F=this.consequent.drop_side_effect_free(G);var D=this.alternative.drop_side_effect_free(G);if(F===this.consequent&&D===this.alternative){return this}if(!F){return D?h(AST_Binary,this,{operator:"||",left:this.condition,right:D}):this.condition.drop_side_effect_free(G)}if(!D){return h(AST_Binary,this,{operator:"&&",left:this.condition,right:F})}var E=this.clone();E.consequent=F;E.alternative=D;return E});C(AST_Unary,function(F,D){if(q(this.operator)){return this}if(this.operator=="typeof"&&this.expression instanceof AST_SymbolRef){return null}var E=this.expression.drop_side_effect_free(F,D);if(D&&this instanceof AST_UnaryPrefix&&i(E)){if(E===this.expression&&this.operator.length===1){return this}return h(AST_UnaryPrefix,this,{operator:this.operator.length===1?this.operator:"!",expression:E})}return E});C(AST_SymbolRef,function(){return this.undeclared()?this:null});C(AST_Object,function(F,E){var D=B(this.properties,F,E);return D&&r(this,D)});C(AST_ObjectProperty,function(E,D){return this.value.drop_side_effect_free(E,D)});C(AST_Array,function(F,E){var D=B(this.elements,F,E);return D&&r(this,D)});C(AST_Dot,function(E,D){if(this.expression.may_throw_on_access(E)){return this}return this.expression.drop_side_effect_free(E,D)});C(AST_Sub,function(G,E){if(this.expression.may_throw_on_access(G)){return this}var F=this.expression.drop_side_effect_free(G,E);if(!F){return this.property.drop_side_effect_free(G,E)}var D=this.property.drop_side_effect_free(G);if(!D){return F}return r(this,[F,D])});C(AST_Sequence,function(G){var E=this.expressions[this.expressions.length-1];var F=E.drop_side_effect_free(G);if(F===E){return this}var D=this.expressions.slice(0,-1);if(F){z(D,F)}return r(this,D)})})(function(C,B){C.DEFMETHOD("drop_side_effect_free",B)});j(AST_SimpleStatement,function(C,E){if(E.option("side_effects")){var B=C.body;var D=B.drop_side_effect_free(E,true);if(!D){E.warn("Dropping side-effect-free statement [{file}:{line},{col}]",C.start);return h(AST_EmptyStatement,C)}if(D!==B){return h(AST_SimpleStatement,C,{body:D})}}return C});j(AST_DWLoop,function(D,H){if(!H.option("loops")){return D}var G=D.condition.evaluate(H);if(G!==D.condition){if(G){return h(AST_For,D,{body:D.body})}if(H.option("dead_code")&&D instanceof AST_While){var B=[];e(H,D.body,B);return h(AST_BlockStatement,D,{body:B}).optimize(H)}if(D instanceof AST_Do){var E=false;var C=new TreeWalker(function(I){if(I instanceof AST_Scope||E){return true}if(I instanceof AST_LoopControl&&C.loopcontrol_target(I)===D){return E=true}});var F=H.parent();(F instanceof AST_LabeledStatement?F:D).walk(C);if(!E){return D.body}}}if(D instanceof AST_While){return h(AST_For,D,D).optimize(H)}return D});function x(B,E){function C(F){F=d(F);if(B.body instanceof AST_BlockStatement){B.body=B.body.clone();B.body.body=F.concat(B.body.body.slice(1));B.body=B.body.transform(E)}else{B.body=h(AST_BlockStatement,B.body,{body:F}).transform(E)}x(B,E)}var D=B.body instanceof AST_BlockStatement?B.body.body[0]:B.body;if(D instanceof AST_If){if(D.body instanceof AST_Break&&E.loopcontrol_target(D.body)===E.self()){if(B.condition){B.condition=h(AST_Binary,B.condition,{left:B.condition,operator:"&&",right:D.condition.negate(E)})}else{B.condition=D.condition.negate(E)}C(D.alternative)}else{if(D.alternative instanceof AST_Break&&E.loopcontrol_target(D.alternative)===E.self()){if(B.condition){B.condition=h(AST_Binary,B.condition,{left:B.condition,operator:"&&",right:D.condition})}else{B.condition=D.condition}C(D.body)}}}}j(AST_For,function(C,E){if(!E.option("loops")){return C}if(C.condition){var D=C.condition.evaluate(E);if(E.option("dead_code")&&!D){var B=[];if(C.init instanceof AST_Statement){B.push(C.init)}else{if(C.init){B.push(h(AST_SimpleStatement,C.init,{body:C.init}))}}e(E,C.body,B);return h(AST_BlockStatement,C,{body:B}).optimize(E)}if(D!==C.condition){D=b(D,C.condition).transform(E);C.condition=a(D,C.condition)}}x(C,E);return C});j(AST_If,function(L,F){if(A(L.alternative)){L.alternative=null}if(!F.option("conditionals")){return L}var I=L.condition.evaluate(F);if(I!==L.condition){if(I){F.warn("Condition always true [{file}:{line},{col}]",L.condition.start);if(F.option("dead_code")){var J=[];if(L.alternative){e(F,L.alternative,J)}J.push(L.body);return h(AST_BlockStatement,L,{body:J}).optimize(F)}}else{F.warn("Condition always false [{file}:{line},{col}]",L.condition.start);if(F.option("dead_code")){var J=[];e(F,L.body,J);if(L.alternative){J.push(L.alternative)}return h(AST_BlockStatement,L,{body:J}).optimize(F)}}I=b(I,L.condition).transform(F);L.condition=a(I,L.condition)}var B=L.condition.negate(F);var C=L.condition.print_to_string().length;var K=B.print_to_string().length;var D=K<C;if(L.alternative&&D){D=false;L.condition=B;var E=L.body;L.body=L.alternative||h(AST_EmptyStatement,L);L.alternative=E}if(A(L.body)&&A(L.alternative)){return h(AST_SimpleStatement,L.condition,{body:L.condition.clone()}).optimize(F)}if(L.body instanceof AST_SimpleStatement&&L.alternative instanceof AST_SimpleStatement){return h(AST_SimpleStatement,L,{body:h(AST_Conditional,L,{condition:L.condition,consequent:L.body.body,alternative:L.alternative.body})}).optimize(F)}if(A(L.alternative)&&L.body instanceof AST_SimpleStatement){if(C===K&&!D&&L.condition instanceof AST_Binary&&L.condition.operator=="||"){D=true}if(D){return h(AST_SimpleStatement,L,{body:h(AST_Binary,L,{operator:"||",left:B,right:L.body.body})}).optimize(F)}return h(AST_SimpleStatement,L,{body:h(AST_Binary,L,{operator:"&&",left:L.condition,right:L.body.body})}).optimize(F)}if(L.body instanceof AST_EmptyStatement&&L.alternative instanceof AST_SimpleStatement){return h(AST_SimpleStatement,L,{body:h(AST_Binary,L,{operator:"||",left:L.condition,right:L.alternative.body})}).optimize(F)}if(L.body instanceof AST_Exit&&L.alternative instanceof AST_Exit&&L.body.TYPE==L.alternative.TYPE){return h(L.body.CTOR,L,{value:h(AST_Conditional,L,{condition:L.condition,consequent:L.body.value||h(AST_Undefined,L.body),alternative:L.alternative.value||h(AST_Undefined,L.alternative)}).transform(F)}).optimize(F)}if(L.body instanceof AST_If&&!L.body.alternative&&!L.alternative){L=h(AST_If,L,{condition:h(AST_Binary,L.condition,{operator:"&&",left:L.condition,right:L.body.condition}),body:L.body.body,alternative:null})}if(y(L.body)){if(L.alternative){var G=L.alternative;L.alternative=null;return h(AST_BlockStatement,L,{body:[L,G]}).optimize(F)}}if(y(L.alternative)){var H=L.body;L.body=L.alternative;L.condition=D?B:L.condition.negate(F);L.alternative=null;return h(AST_BlockStatement,L,{body:[L,H]}).optimize(F)}return L});j(AST_Switch,function(K,H){if(!H.option("switches")){return K}var B;var O=K.expression.evaluate(H);if(O!==K.expression){var I=b(O,K.expression).transform(H);K.expression=a(I,K.expression)}if(!H.option("dead_code")){return K}var D=[];var G=[];var L;var C;for(var P=0,Q=K.body.length;P<Q&&!C;P++){B=K.body[P];if(B instanceof AST_Default){if(!L){L=B}else{E(B,G[G.length-1])}}else{if(O!==K.expression){var F=B.expression.evaluate(H);if(F===O){C=B;if(L){var J=G.indexOf(L);G.splice(J,1);E(L,G[J-1]);L=null}}else{if(F!==B.expression){E(B,G[G.length-1]);continue}}}}if(y(B)){var M=G[G.length-1];if(y(M)&&M.body.length==B.body.length&&h(AST_BlockStatement,M,M).equivalent_to(h(AST_BlockStatement,B,B))){M.body=[]}}G.push(B)}while(P<Q){E(K.body[P++],G[G.length-1])}if(G.length>0){G[0].body=D.concat(G[0].body)}K.body=G;while(B=G[G.length-1]){var R=B.body[B.body.length-1];if(R instanceof AST_Break&&H.loopcontrol_target(R)===K){B.body.pop()}if(B.body.length||B instanceof AST_Case&&(L||B.expression.has_side_effects(H))){break}if(G.pop()===L){L=null}}if(G.length==0){return h(AST_BlockStatement,K,{body:D.concat(h(AST_SimpleStatement,K.expression,{body:K.expression}))}).optimize(H)}if(G.length==1&&(G[0]===C||G[0]===L)){var N=false;var S=new TreeWalker(function(T){if(N||T instanceof AST_Lambda||T instanceof AST_SimpleStatement){return true}if(T instanceof AST_Break&&S.loopcontrol_target(T)===K){N=true}});K.walk(S);if(!N){G=G[0].body.slice();G.unshift(h(AST_SimpleStatement,K.expression,{body:K.expression}));return h(AST_BlockStatement,K,{body:G}).optimize(H)}}return K;function E(T,U){if(U&&!y(U)){U.body=U.body.concat(T.body)}else{e(H,T,D)}}});j(AST_Try,function(C,D){l(C.body,D);if(C.bcatch&&C.bfinally&&all(C.bfinally.body,A)){C.bfinally=null}if(all(C.body,A)){var B=[];if(C.bcatch){e(D,C.bcatch,B)}if(C.bfinally){B=B.concat(C.bfinally.body)}return h(AST_BlockStatement,C,{body:B}).optimize(D)}return C});AST_Definitions.DEFMETHOD("remove_initializers",function(){this.definitions.forEach(function(B){B.value=null})});AST_Definitions.DEFMETHOD("to_assignments",function(D){var C=D.option("reduce_vars");var B=this.definitions.reduce(function(E,G){if(G.value){var F=h(AST_SymbolRef,G.name,G.name);E.push(h(AST_Assign,G,{operator:"=",left:F,right:G.value}));if(C){F.definition().fixed=false}}return E},[]);if(B.length==0){return null}return r(this,B)});j(AST_Definitions,function(B,C){if(B.definitions.length==0){return h(AST_EmptyStatement,B)}return B});j(AST_Call,function(P,N){var K=P.expression;var L=K;if(N.option("unused")&&(L instanceof AST_Function||N.option("reduce_vars")&&L instanceof AST_SymbolRef&&(L=L.fixed_value()) instanceof AST_Function)&&!L.uses_arguments&&!L.uses_eval){var G=0,M=0;for(var T=0,V=P.args.length;T<V;T++){var U=T>=L.argnames.length;if(U||L.argnames[T].__unused){var S=P.args[T].drop_side_effect_free(N);if(S){P.args[G++]=S}else{if(!U){P.args[G++]=h(AST_Number,P.args[T],{value:0});continue}}}else{P.args[G++]=P.args[T]}M=G}P.args.length=M}if(N.option("unsafe")){if(K instanceof AST_SymbolRef&&K.undeclared()){switch(K.name){case"Array":if(P.args.length!=1){return h(AST_Array,P,{elements:P.args}).optimize(N)}break;case"Object":if(P.args.length==0){return h(AST_Object,P,{properties:[]})}break;case"String":if(P.args.length==0){return h(AST_String,P,{value:""})}if(P.args.length<=1){return h(AST_Binary,P,{left:P.args[0],operator:"+",right:h(AST_String,P,{value:""})}).optimize(N)}break;case"Number":if(P.args.length==0){return h(AST_Number,P,{value:0})}if(P.args.length==1){return h(AST_UnaryPrefix,P,{expression:P.args[0],operator:"+"}).optimize(N)}case"Boolean":if(P.args.length==0){return h(AST_False,P)}if(P.args.length==1){return h(AST_UnaryPrefix,P,{expression:h(AST_UnaryPrefix,P,{expression:P.args[0],operator:"!"}),operator:"!"}).optimize(N)}break}}else{if(K instanceof AST_Dot&&K.property=="toString"&&P.args.length==0){return h(AST_Binary,P,{left:h(AST_String,P,{value:""}),operator:"+",right:K.expression}).optimize(N)}else{if(K instanceof AST_Dot&&K.expression instanceof AST_Array&&K.property=="join"){EXIT:{var E;if(P.args.length>0){E=P.args[0].evaluate(N);if(E===P.args[0]){break EXIT}}var O=[];var Q=[];K.expression.elements.forEach(function(ad){var ae=ad.evaluate(N);if(ae!==ad){Q.push(ae)}else{if(Q.length>0){O.push(h(AST_String,P,{value:Q.join(E)}));Q.length=0}O.push(ad)}});if(Q.length>0){O.push(h(AST_String,P,{value:Q.join(E)}))}if(O.length==0){return h(AST_String,P,{value:""})}if(O.length==1){if(O[0].is_string(N)){return O[0]}return h(AST_Binary,O[0],{operator:"+",left:h(AST_String,P,{value:""}),right:O[0]})}if(E==""){var I;if(O[0].is_string(N)||O[1].is_string(N)){I=O.shift()}else{I=h(AST_String,P,{value:""})}return O.reduce(function(ae,ad){return h(AST_Binary,ad,{operator:"+",left:ae,right:ad})},I).optimize(N)}var S=P.clone();S.expression=S.expression.clone();S.expression.expression=S.expression.expression.clone();S.expression.expression.elements=O;return p(N,P,S)}}else{if(K instanceof AST_Dot&&K.expression.is_string(N)&&K.property=="charAt"){var F=P.args[0];var H=F?F.evaluate(N):0;if(H!==F){return h(AST_Sub,K,{expression:K.expression,property:b(H|0,F||K)}).optimize(N)}}}}}}if(N.option("unsafe_Func")&&K instanceof AST_SymbolRef&&K.undeclared()&&K.name=="Function"){if(P.args.length==0){return h(AST_Function,P,{argnames:[],body:[]})}if(all(P.args,function(ad){return ad instanceof AST_String})){try{var B="n(function("+P.args.slice(0,-1).map(function(ad){return ad.value}).join(",")+"){"+P.args[P.args.length-1].value+"})";var J=parse(B);var D={ie8:N.option("ie8")};J.figure_out_scope(D);var Z=new Compressor(N.options);J=J.transform(Z);J.figure_out_scope(D);base54.reset();J.compute_char_frequency(D);J.mangle_names(D);var aa;J.walk(new TreeWalker(function(ad){if(aa){return true}if(ad instanceof AST_Lambda){aa=ad;return true}}));var B=OutputStream();AST_BlockStatement.prototype._codegen.call(aa,aa,B);P.args=[h(AST_String,P,{value:aa.argnames.map(function(ad){return ad.print_to_string()}).join(",")}),h(AST_String,P.args[P.args.length-1],{value:B.get().replace(/^\{|\}$/g,"")})];return P}catch(W){if(W instanceof JS_Parse_Error){N.warn("Error parsing code passed to new Function [{file}:{line},{col}]",P.args[P.args.length-1].start);N.warn(W.toString())}else{throw W}}}}var X=L instanceof AST_Function&&L.body[0];if(N.option("inline")&&X instanceof AST_Return){var R=X.value;if(!R||R.is_constant_expression()){var C=P.args.concat(R||h(AST_Undefined,P));return r(P,C).optimize(N)}}if(K instanceof AST_Function){if(N.option("inline")&&!K.name&&!K.uses_arguments&&!K.uses_eval&&K.body.length==1&&all(K.argnames,function(ad){return ad.__unused})&&!P.has_pure_annotation(N)){var R;if(X instanceof AST_Return){R=X.value}else{if(X instanceof AST_SimpleStatement){R=h(AST_UnaryPrefix,X,{operator:"void",expression:X.body})}}if(R){var ab=new TreeWalker(function(ae){if(!R){return true}if(ae instanceof AST_SymbolRef){var ad=ae.scope.find_variable(ae);if(ad&&ad.scope.parent_scope===L.parent_scope){R=null;return true}}if(ae instanceof AST_This&&!ab.find_parent(AST_Scope)){R=null;return true}});R.walk(ab)}if(R){var C=P.args.concat(R);return r(P,C).optimize(N)}}if(N.option("side_effects")&&all(K.body,A)){var C=P.args.concat(h(AST_Undefined,P));return r(P,C).optimize(N)}}if(N.option("drop_console")){if(K instanceof AST_PropAccess){var ac=K.expression;while(ac.expression){ac=ac.expression}if(ac instanceof AST_SymbolRef&&ac.name=="console"&&ac.undeclared()){return h(AST_Undefined,P).optimize(N)}}}if(N.option("negate_iife")&&N.parent() instanceof AST_SimpleStatement&&i(P)){return P.negate(N,true)}var Y=P.evaluate(N);if(Y!==P){Y=b(Y,P).optimize(N);return p(N,Y,P)}return P});j(AST_New,function(B,D){if(D.option("unsafe")){var C=B.expression;if(C instanceof AST_SymbolRef&&C.undeclared()){switch(C.name){case"Object":case"RegExp":case"Function":case"Error":case"Array":return h(AST_Call,B,B).transform(D)}}}return B});j(AST_Sequence,function(D,H){if(!H.option("side_effects")){return D}var G=[];E();var C=G.length-1;F();if(C>0&&H.option("cascade")){B()}if(C==0){D=t(H.parent(),D,G[0]);if(!(D instanceof AST_Sequence)){D=D.optimize(H)}return D}D.expressions=G;return D;function E(){var J=first_in_statement(H);var I=D.expressions.length-1;D.expressions.forEach(function(L,K){if(K<I){L=L.drop_side_effect_free(H,J)}if(L){z(G,L);J=false}})}function F(){while(C>0&&v(G[C],H)){C--}if(C<G.length-1){G[C]=h(AST_UnaryPrefix,D,{operator:"void",expression:G[C]});G.length=C+1}}function B(){for(var K=0,J=1;J<=C;J++){var O=G[K];var N=G[J];if(O instanceof AST_Assign&&!O.left.has_side_effects(H)){O=O.left}else{if(O instanceof AST_Unary&&(O.operator=="++"||O.operator=="--")){O=O.expression}else{O=null}}if(!O||m(O)){G[++K]=N;continue}var L=null,M;G[J]=N=N.clone();while(true){if(N.equivalent_to(O)){var I=G[K];if(I instanceof AST_UnaryPostfix){I=h(AST_UnaryPrefix,I,{operator:I.operator,expression:O})}if(L){L[M]=I;G[K]=G[J]}else{G[K]=I}break}if(N instanceof AST_Binary&&!(N instanceof AST_Assign)){if(N.left.is_constant()){if(N.operator=="||"||N.operator=="&&"){G[++K]=G[J];break}M="right"}else{M="left"}}else{if(N instanceof AST_Call&&!(O instanceof AST_PropAccess&&N.expression.equivalent_to(O))||N instanceof AST_PropAccess||N instanceof AST_Unary&&!q(N.operator)){M="expression"}else{if(N instanceof AST_Conditional){M="condition"}else{G[++K]=G[J];break}}}L=N;N=N[M]=N[M].clone()}}C=K;G.length=C+1}});AST_Unary.DEFMETHOD("lift_sequences",function(D){if(D.option("sequences")){if(this.expression instanceof AST_Sequence){var B=this.expression.expressions.slice();var C=this.clone();C.expression=B.pop();B.push(C);return r(this,B).optimize(D)}}return this});j(AST_UnaryPostfix,function(B,C){return B.lift_sequences(C)});j(AST_UnaryPrefix,function(C,F){var E=C.expression;if(C.operator=="delete"&&!(E instanceof AST_SymbolRef||E instanceof AST_PropAccess||E instanceof AST_NaN||E instanceof AST_Infinity||E instanceof AST_Undefined)){if(E instanceof AST_Sequence){E=E.expressions.slice();E.push(h(AST_True,C));return r(C,E).optimize(F)}return r(C,[E,h(AST_True,C)]).optimize(F)}var B=C.lift_sequences(F);if(B!==C){return B}if(F.option("side_effects")&&C.operator=="void"){E=E.drop_side_effect_free(F);if(E){C.expression=E;return C}else{return h(AST_Undefined,C).optimize(F)}}if(F.option("booleans")&&F.in_boolean_context()){switch(C.operator){case"!":if(E instanceof AST_UnaryPrefix&&E.operator=="!"){return E.expression}if(E instanceof AST_Binary){C=p(F,C,E.negate(F,first_in_statement(F)))}break;case"typeof":F.warn("Boolean expression always true [{file}:{line},{col}]",C.start);return(E instanceof AST_SymbolRef?h(AST_True,C):r(C,[E,h(AST_True,C)])).optimize(F)}}if(C.operator=="-"&&E instanceof AST_Infinity){E=E.transform(F)}if(E instanceof AST_Binary&&(C.operator=="+"||C.operator=="-")&&(E.operator=="*"||E.operator=="/"||E.operator=="%")){return h(AST_Binary,C,{operator:E.operator,left:h(AST_UnaryPrefix,E.left,{operator:C.operator,expression:E.left}),right:E.right})}if(C.operator!="-"||!(E instanceof AST_Number||E instanceof AST_Infinity)){var D=C.evaluate(F);if(D!==C){D=b(D,C).optimize(F);return p(F,D,C)}}return C});AST_Binary.DEFMETHOD("lift_sequences",function(G){if(G.option("sequences")){if(this.left instanceof AST_Sequence){var B=this.left.expressions.slice();var F=this.clone();F.left=B.pop();B.push(F);return r(this,B).optimize(G)}if(this.right instanceof AST_Sequence&&!this.left.has_side_effects(G)){var C=this.operator=="="&&this.left instanceof AST_SymbolRef;var B=this.right.expressions;var E=B.length-1;for(var D=0;D<E;D++){if(!C&&B[D].has_side_effects(G)){break}}if(D==E){B=B.slice();var F=this.clone();F.right=B.pop();B.push(F);return r(this,B).optimize(G)}else{if(D>0){var F=this.clone();F.right=r(this.right,B.slice(D));B=B.slice(0,D);B.push(F);return r(this,B).optimize(G)}}}}return this});var o=makePredicate("== === != !== * & | ^");j(AST_Binary,function(L,G){function C(){return L.left.is_constant()||L.right.is_constant()||!L.left.has_side_effects(G)&&!L.right.has_side_effects(G)}function H(N){if(C()){if(N){L.operator=N}var M=L.left;L.left=L.right;L.right=M}}if(o(L.operator)){if(L.right.is_constant()&&!L.left.is_constant()){if(!(L.left instanceof AST_Binary&&PRECEDENCE[L.left.operator]>=PRECEDENCE[L.operator])){H()}}}L=L.lift_sequences(G);if(G.option("comparisons")){switch(L.operator){case"===":case"!==":if((L.left.is_string(G)&&L.right.is_string(G))||(L.left.is_number(G)&&L.right.is_number(G))||(L.left.is_boolean()&&L.right.is_boolean())){L.operator=L.operator.substr(0,2)}case"==":case"!=":if(G.option("typeofs")&&L.left instanceof AST_String&&L.left.value=="undefined"&&L.right instanceof AST_UnaryPrefix&&L.right.operator=="typeof"){var K=L.right.expression;if(K instanceof AST_SymbolRef?!K.undeclared():!(K instanceof AST_PropAccess&&G.option("ie8"))){L.right=K;L.left=h(AST_Undefined,L.left).optimize(G);if(L.operator.length==2){L.operator+="="}}}break}}if(G.option("booleans")&&L.operator=="+"&&G.in_boolean_context()){var J=L.left.evaluate(G);var E=L.right.evaluate(G);if(J&&typeof J=="string"){G.warn("+ in boolean context always true [{file}:{line},{col}]",L.start);return r(L,[L.right,h(AST_True,L)]).optimize(G)}if(E&&typeof E=="string"){G.warn("+ in boolean context always true [{file}:{line},{col}]",L.start);return r(L,[L.left,h(AST_True,L)]).optimize(G)}}if(G.option("comparisons")&&L.is_boolean()){if(!(G.parent() instanceof AST_Binary)||G.parent() instanceof AST_Assign){var B=h(AST_UnaryPrefix,L,{operator:"!",expression:L.negate(G,first_in_statement(G))});L=p(G,L,B)}if(G.option("unsafe_comps")){switch(L.operator){case"<":H(">");break;case"<=":H(">=");break}}}if(L.operator=="+"){if(L.right instanceof AST_String&&L.right.getValue()==""&&L.left.is_string(G)){return L.left}if(L.left instanceof AST_String&&L.left.getValue()==""&&L.right.is_string(G)){return L.right}if(L.left instanceof AST_Binary&&L.left.operator=="+"&&L.left.left instanceof AST_String&&L.left.left.getValue()==""&&L.right.is_string(G)){L.left=L.left.right;return L.transform(G)}}if(G.option("evaluate")){switch(L.operator){case"&&":var J=L.left.evaluate(G);if(!J){G.warn("Condition left of && always false [{file}:{line},{col}]",L.start);return t(G.parent(),L,L.left).optimize(G)}else{if(J!==L.left){G.warn("Condition left of && always true [{file}:{line},{col}]",L.start);return t(G.parent(),L,L.right).optimize(G)}}if(G.option("booleans")&&G.in_boolean_context()){var E=L.right.evaluate(G);if(!E){G.warn("Boolean && always false [{file}:{line},{col}]",L.start);return r(L,[L.left,h(AST_False,L)]).optimize(G)}else{if(E!==L.right){G.warn("Dropping side-effect-free && in boolean context [{file}:{line},{col}]",L.start);return L.left.optimize(G)}}}break;case"||":var J=L.left.evaluate(G);if(!J){G.warn("Condition left of || always false [{file}:{line},{col}]",L.start);return t(G.parent(),L,L.right).optimize(G)}else{if(J!==L.left){G.warn("Condition left of || always true [{file}:{line},{col}]",L.start);return t(G.parent(),L,L.left).optimize(G)}}if(G.option("booleans")&&G.in_boolean_context()){var E=L.right.evaluate(G);if(!E){G.warn("Dropping side-effect-free || in boolean context [{file}:{line},{col}]",L.start);return L.left.optimize(G)}else{if(E!==L.right){G.warn("Boolean || always true [{file}:{line},{col}]",L.start);return r(L,[L.left,h(AST_True,L)]).optimize(G)}}}break}var D=true;switch(L.operator){case"+":if(L.left instanceof AST_Constant&&L.right instanceof AST_Binary&&L.right.operator=="+"&&L.right.left instanceof AST_Constant&&L.right.is_string(G)){L=h(AST_Binary,L,{operator:"+",left:h(AST_String,L.left,{value:""+L.left.getValue()+L.right.left.getValue(),start:L.left.start,end:L.right.left.end}),right:L.right.right})}if(L.right instanceof AST_Constant&&L.left instanceof AST_Binary&&L.left.operator=="+"&&L.left.right instanceof AST_Constant&&L.left.is_string(G)){L=h(AST_Binary,L,{operator:"+",left:L.left.left,right:h(AST_String,L.right,{value:""+L.left.right.getValue()+L.right.getValue(),start:L.left.right.start,end:L.right.end})})}if(L.left instanceof AST_Binary&&L.left.operator=="+"&&L.left.is_string(G)&&L.left.right instanceof AST_Constant&&L.right instanceof AST_Binary&&L.right.operator=="+"&&L.right.left instanceof AST_Constant&&L.right.is_string(G)){L=h(AST_Binary,L,{operator:"+",left:h(AST_Binary,L.left,{operator:"+",left:L.left.left,right:h(AST_String,L.left.right,{value:""+L.left.right.getValue()+L.right.left.getValue(),start:L.left.right.start,end:L.right.left.end})}),right:L.right.right})}if(L.right instanceof AST_UnaryPrefix&&L.right.operator=="-"&&L.left.is_number(G)){L=h(AST_Binary,L,{operator:"-",left:L.left,right:L.right.expression});break}if(L.left instanceof AST_UnaryPrefix&&L.left.operator=="-"&&C()&&L.right.is_number(G)){L=h(AST_Binary,L,{operator:"-",left:L.right,right:L.left.expression});break}case"*":D=G.option("unsafe_math");case"&":case"|":case"^":if(L.left.is_number(G)&&L.right.is_number(G)&&C()&&!(L.left instanceof AST_Binary&&L.left.operator!=L.operator&&PRECEDENCE[L.left.operator]>=PRECEDENCE[L.operator])){var F=h(AST_Binary,L,{operator:L.operator,left:L.right,right:L.left});if(L.right instanceof AST_Constant&&!(L.left instanceof AST_Constant)){L=p(G,F,L)}else{L=p(G,L,F)}}if(D&&L.is_number(G)){if(L.right instanceof AST_Binary&&L.right.operator==L.operator){L=h(AST_Binary,L,{operator:L.operator,left:h(AST_Binary,L.left,{operator:L.operator,left:L.left,right:L.right.left,start:L.left.start,end:L.right.left.end}),right:L.right.right})}if(L.right instanceof AST_Constant&&L.left instanceof AST_Binary&&L.left.operator==L.operator){if(L.left.left instanceof AST_Constant){L=h(AST_Binary,L,{operator:L.operator,left:h(AST_Binary,L.left,{operator:L.operator,left:L.left.left,right:L.right,start:L.left.left.start,end:L.right.end}),right:L.left.right})}else{if(L.left.right instanceof AST_Constant){L=h(AST_Binary,L,{operator:L.operator,left:h(AST_Binary,L.left,{operator:L.operator,left:L.left.right,right:L.right,start:L.left.right.start,end:L.right.end}),right:L.left.left})}}}if(L.left instanceof AST_Binary&&L.left.operator==L.operator&&L.left.right instanceof AST_Constant&&L.right instanceof AST_Binary&&L.right.operator==L.operator&&L.right.left instanceof AST_Constant){L=h(AST_Binary,L,{operator:L.operator,left:h(AST_Binary,L.left,{operator:L.operator,left:h(AST_Binary,L.left.left,{operator:L.operator,left:L.left.right,right:L.right.left,start:L.left.right.start,end:L.right.left.end}),right:L.left.left}),right:L.right.right})}}}}if(L.right instanceof AST_Binary&&L.right.operator==L.operator&&(L.operator=="&&"||L.operator=="||"||(L.operator=="+"&&(L.right.left.is_string(G)||(L.left.is_string(G)&&L.right.right.is_string(G)))))){L.left=h(AST_Binary,L.left,{operator:L.operator,left:L.left,right:L.right.left});L.right=L.right.right;return L.transform(G)}var I=L.evaluate(G);if(I!==L){I=b(I,L).optimize(G);return p(G,I,L)}return L});j(AST_SymbolRef,function(L,E){var C=L.resolve_defines(E);if(C){return C.optimize(E)}if(!E.option("ie8")&&L.undeclared()&&(!L.scope.uses_with||!E.find_parent(AST_With))){switch(L.name){case"undefined":return h(AST_Undefined,L).optimize(E);case"NaN":return h(AST_NaN,L).optimize(E);case"Infinity":return h(AST_Infinity,L).optimize(E)}}if(E.option("reduce_vars")&&s(L,E.parent())!==L){var F=L.definition();var D=L.fixed_value();if(D instanceof AST_Defun){F.fixed=D=h(AST_Function,D,D)}if(E.option("unused")&&D instanceof AST_Function&&F.references.length==1&&!(F.scope.uses_arguments&&F.orig[0] instanceof AST_SymbolFunarg)&&!F.scope.uses_eval&&E.find_parent(AST_Scope)===D.parent_scope){return D.clone(true)}if(E.option("evaluate")&&D){if(F.should_replace===undefined){var K=D.evaluate(E);if(K!==D&&(E.option("unsafe_regexp")||!(K instanceof RegExp))){K=b(K,D);var G=K.optimize(E).print_to_string().length;var H;if(B(D)){H=function(){var M=K.optimize(E);return M===K?M.clone(true):M}}else{G=Math.min(G,D.print_to_string().length);H=function(){var M=a(K.optimize(E),D);return M===K||M===D?M.clone(true):M}}var I=F.name.length;var J=0;if(E.option("unused")&&!E.exposed(F)){J=(I+2+G)/F.references.length}F.should_replace=G<=I+J?H:false}else{F.should_replace=false}}if(F.should_replace){return F.should_replace()}}}return L;function B(N){var M;N.walk(new TreeWalker(function(O){if(O instanceof AST_SymbolRef){M=true}if(M){return true}}));return M}});function u(B,C){return B instanceof AST_SymbolRef||B.TYPE===C.TYPE}j(AST_Undefined,function(C,F){if(F.option("unsafe")){var D=f(F,"undefined");if(D){var E=h(AST_SymbolRef,C,{name:"undefined",scope:D.scope,thedef:D});E.is_undefined=true;return E}}var B=s(F.self(),F.parent());if(B&&u(B,C)){return C}return h(AST_UnaryPrefix,C,{operator:"void",expression:h(AST_Number,C,{value:0})})});j(AST_Infinity,function(C,D){var B=s(D.self(),D.parent());if(B&&u(B,C)){return C}if(D.option("keep_infinity")&&!(B&&!u(B,C))&&!f(D,"Infinity")){return C}return h(AST_Binary,C,{operator:"/",left:h(AST_Number,C,{value:1}),right:h(AST_Number,C,{value:0})})});j(AST_NaN,function(C,D){var B=s(D.self(),D.parent());if(B&&!u(B,C)||f(D,"NaN")){return h(AST_Binary,C,{operator:"/",left:h(AST_Number,C,{value:0}),right:h(AST_Number,C,{value:0})})}return C});var w=["+","-","/","*","%",">>","<<",">>>","|","^","&"];var g=["*","|","^","&"];j(AST_Assign,function(B,C){B=B.lift_sequences(C);if(B.operator=="="&&B.left instanceof AST_SymbolRef&&B.right instanceof AST_Binary){if(B.right.left instanceof AST_SymbolRef&&B.right.left.name==B.left.name&&member(B.right.operator,w)){B.operator=B.right.operator+"=";B.right=B.right.right}else{if(B.right.right instanceof AST_SymbolRef&&B.right.right.name==B.left.name&&member(B.right.operator,g)&&!B.right.left.has_side_effects(C)){B.operator=B.right.operator+"=";B.right=B.right.left}}}return B});j(AST_Conditional,function(L,F){if(!F.option("conditionals")){return L}if(L.condition instanceof AST_Sequence){var G=L.condition.expressions.slice();L.condition=G.pop();G.push(L);return r(L,G)}var J=L.condition.evaluate(F);if(J!==L.condition){if(J){F.warn("Condition always true [{file}:{line},{col}]",L.start);return t(F.parent(),L,L.consequent)}else{F.warn("Condition always false [{file}:{line},{col}]",L.start);return t(F.parent(),L,L.alternative)}}var B=J.negate(F,first_in_statement(F));if(p(F,J,B)===B){L=h(AST_Conditional,L,{condition:B,consequent:L.alternative,alternative:L.consequent})}var D=L.condition;var H=L.consequent;var C=L.alternative;if(D instanceof AST_SymbolRef&&H instanceof AST_SymbolRef&&D.definition()===H.definition()){return h(AST_Binary,L,{operator:"||",left:D,right:C})}if(H instanceof AST_Assign&&C instanceof AST_Assign&&H.operator==C.operator&&H.left.equivalent_to(C.left)&&(!L.condition.has_side_effects(F)||H.operator=="="&&!H.left.has_side_effects(F))){return h(AST_Assign,L,{operator:H.operator,left:H.left,right:h(AST_Conditional,L,{condition:L.condition,consequent:H.right,alternative:C.right})})}if(H instanceof AST_Call&&C.TYPE===H.TYPE&&H.args.length==1&&C.args.length==1&&H.expression.equivalent_to(C.expression)&&!H.expression.has_side_effects(F)){H.args[0]=h(AST_Conditional,L,{condition:L.condition,consequent:H.args[0],alternative:C.args[0]});return H}if(H instanceof AST_Conditional&&H.alternative.equivalent_to(C)){return h(AST_Conditional,L,{condition:h(AST_Binary,L,{left:L.condition,operator:"&&",right:H.condition}),consequent:H.consequent,alternative:C})}if(H.equivalent_to(C)){return r(L,[L.condition,H]).optimize(F)}if(E(L.consequent)){if(I(L.alternative)){return K(L.condition)}return h(AST_Binary,L,{operator:"||",left:K(L.condition),right:L.alternative})}if(I(L.consequent)){if(E(L.alternative)){return K(L.condition.negate(F))}return h(AST_Binary,L,{operator:"&&",left:K(L.condition.negate(F)),right:L.alternative})}if(E(L.alternative)){return h(AST_Binary,L,{operator:"||",left:K(L.condition.negate(F)),right:L.consequent})}if(I(L.alternative)){return h(AST_Binary,L,{operator:"&&",left:K(L.condition),right:L.consequent})}return L;function K(M){if(M.is_boolean()){return M}return h(AST_UnaryPrefix,M,{operator:"!",expression:M.negate(F)})}function E(M){return M instanceof AST_True||(M instanceof AST_UnaryPrefix&&M.operator=="!"&&M.expression instanceof AST_Constant&&!M.expression.value)}function I(M){return M instanceof AST_False||(M instanceof AST_UnaryPrefix&&M.operator=="!"&&M.expression instanceof AST_Constant&&!!M.expression.value)}});j(AST_Boolean,function(B,D){if(D.option("booleans")){var C=D.parent();if(C instanceof AST_Binary&&(C.operator=="=="||C.operator=="!=")){D.warn("Non-strict equality against boolean: {operator} {value} [{file}:{line},{col}]",{operator:C.operator,value:B.value,file:C.start.file,line:C.start.line,col:C.start.col});return h(AST_Number,B,{value:+B.value})}return h(AST_UnaryPrefix,B,{operator:"!",expression:h(AST_Number,B,{value:1-B.value})})}return B});j(AST_Sub,function(C,F){var E=C.property;if(E instanceof AST_String&&F.option("properties")){E=E.getValue();if(RESERVED_WORDS(E)?!F.option("ie8"):is_identifier_string(E)){return h(AST_Dot,C,{expression:C.expression,property:E}).optimize(F)}var B=parseFloat(E);if(!isNaN(B)&&B.toString()==E){C.property=h(AST_Number,C.property,{value:B})}}var D=C.evaluate(F);if(D!==C){D=b(D,C).optimize(F);return p(F,D,C)}return C});AST_Lambda.DEFMETHOD("contains_this",function(){var B;var C=this;C.walk(new TreeWalker(function(D){if(B){return true}if(D instanceof AST_This){return B=true}if(D!==C&&D instanceof AST_Scope){return true}}));return B});j(AST_Dot,function(K,E){var C=K.resolve_defines(E);if(C){return C.optimize(E)}var B=K.property;if(RESERVED_WORDS(B)&&E.option("ie8")){return h(AST_Sub,K,{expression:K.expression,property:h(AST_String,K,{value:B})}).optimize(E)}if(E.option("unsafe")&&K.expression instanceof AST_Object){var J=K.expression.properties;for(var G=J.length;--G>=0;){if(J[G].key===B){var I=J[G].value;if(I instanceof AST_Function?!I.contains_this():!I.has_side_effects(E)){var F=K.expression.clone();F.properties=F.properties.slice();F.properties.splice(G,1);return r(K,[F,I]).optimize(E)}}}}if(E.option("unsafe_proto")&&K.expression instanceof AST_Dot&&K.expression.property=="prototype"){var D=K.expression.expression;if(D instanceof AST_SymbolRef&&D.undeclared()){switch(D.name){case"Array":K.expression=h(AST_Array,K.expression,{elements:[]});break;case"Object":K.expression=h(AST_Object,K.expression,{properties:[]});break;case"String":K.expression=h(AST_String,K.expression,{value:""});break}}}var H=K.evaluate(E);if(H!==K){H=b(H,K).optimize(E);return p(E,H,K)}return K});function n(B,C){if(C.option("booleans")&&C.in_boolean_context()){return p(C,B,r(B,[B,h(AST_True,B)]).optimize(C))}return B}j(AST_Array,n);j(AST_Object,n);j(AST_RegExp,n);j(AST_Return,function(B,C){if(B.value&&v(B.value,C)){B.value=null}return B});j(AST_VarDef,function(B,D){var C=D.option("global_defs");if(C&&HOP(C,B.name.name)){D.warn("global_defs "+B.name.name+" redefined [{file}:{line},{col}]",B.start)}return B})})();